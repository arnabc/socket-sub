<!DOCTYPE html> 
<html> 
<head> 
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
    <style type="text/css"> 
    html { height: 100% }
    body { height: 100%; margin: 0px; padding: 0px }
    #map_canvas { height: 100% }
    </style> 
    <title></title> 
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
    <script type="text/javascript" src="http://s3.amazonaws.com/le_bazar_de_julien/xmlDOM/jquery.xmldom.js"></script>

    <script type="text/javascript"> 

    function initialize() {
    }
        
    </script> 
</head> 
<body onload="initialize()"> 
    <div id="map_canvas"></div> 
    <script>
    $(document).ready(function() {
        
        var lat      = 41.900297;
        var lon      = 12.47077
        var myLatlng = new google.maps.LatLng(lat, lon);
        
        var myOptions = {
            zoom: 3,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.TERRAIN
        }
        var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        
        var index = 0;
        
        var conn = {},
        serverUri;

        function startConnection() {
            var host = "node.superfeedr.com",
            port = 27261;
            serverUri = "ws://"+host+":"+port;
            openConnection();
        }

        function openConnection() {
            if ( !conn.readyState || conn.readyState > 1 ) {

                conn = new WebSocket( serverUri );

                conn.onopen = function () {
                    conn.send("http://superfeedr.com/track/gowalla&hub=hub.gowalla.com");
                };

                conn.onmessage = function( event ) {
                    var message = (typeof event.data === "string") ? event.data : JSON.parse( event.data );
                    $.xmlDOM(message).find('feed > entry > point').each(function() {
                        index +=1 ;
                        // if(index == 1) {
                            var latlon = $(this).text().split(" ");
                            map.panTo(new google.maps.LatLng(parseFloat(latlon[0]), parseFloat(latlon[1])));
                        // }
                    });
                };

                conn.onclose = function( event ) {
                    // alert("closed!");
                };
            }
        }

        if (!window.WebSocket) {
            // Doh, Websockets not supported!
        } else {
            startConnection();
        }
    });
    </script>
</body> 
</html>